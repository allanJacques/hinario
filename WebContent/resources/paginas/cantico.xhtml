<ui:composition template="/WEB-INF/paginas/template.xhtml" xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:f="http://java.sun.com/jsf/core" xmlns:h="http://java.sun.com/jsf/html" xmlns:p="http://primefaces.org/ui" xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:pe="http://primefaces.org/ui/extensions">
	<ui:define name="title">#{strg['label.canticos']}</ui:define> -->
<ui:define name="inHead">
		<style>
input#consolador_input, input#recebedor_input {
	width: 400px;
}

input.exibeCantico {
	width: 400px;
}
</style>
	</ui:define>
	<ui:define name="body">
		<!-- ======================================================== EDITOR ======================================================== -->
		<h:form id="editor" prependId="false" acceptcharset="UTF-8">
			<p:panel>
				<p:growl id="growl" showDetail="true" sticky="true" globalOnly="true" />
				<p:wizard backLabel="Voltar" nextLabel="PrÃ³ximo" flowListener="#{canticoBean.trocaAba}" showNavBar="true" showStepStatus="true" widgetVar="wizard">
					<p:tab id="tabConsoladorRecebedor" title="#{strg['label.aba.consoladorERecebedor']}">
						<p:panel id="painelConsoladorRecebedor">
							<p:focus context="painelConsoladorRecebedor" />
							<h:panelGrid columns="4" cellspacing="15px">
								<p:outputLabel value="#{strg['label.consolador']}" for="consolador" />
								<p:autoComplete id="consolador" value="#{canticoBean.cantico.consolador}" title="#{canticoBean.cantico.consolador}" required="true" forceSelection="true" completeMethod="#{consoladorBean.listaSugestoesBean}" var="consolador" itemLabel="#{consolador.irmao.nome}" itemValue="#{consolador}" minQueryLength="3" />
								<p:message for="consolador" />
								<p:commandLink title="#{strg['label.incluirNovoConsolador']}" value="#{strg['label.incluirNovoConsolador']}" onclick="PF('dialogConsolador').show();" styleClass="linkIncluirNovo" />

								<p:outputLabel value="#{strg['label.recebedor']}" for="recebedor" />
								<p:autoComplete id="recebedor" value="#{canticoBean.cantico.recebedor}" title="#{canticoBean.cantico.recebedor}" required="false" forceSelection="true" completeMethod="#{recebedorBean.listaSugestoesBean}" var="recebedor" itemLabel="#{recebedor.irmao.nome}" itemValue="#{recebedor}" minQueryLength="3" style="min-width: 200px" />
								<p:message for="recebedor" />
								<p:commandLink title="#{strg['label.incluirNovoRecebedor']}" value="#{strg['label.incluirNovoRecebedor']}" onclick="PF('dialogRecebedor').show();" styleClass="linkIncluirNovo" />
							</h:panelGrid>
						</p:panel>
					</p:tab>
					<p:tab id="datas" title="#{strg['label.aba.datas']}">
						<p:panel id="painelDatas">
							<p:focus context="painelDatas" />
							<h:panelGrid columns="3">
								<p:outputLabel value="#{strg['label.dataCadastro']}" for="dataCadastro" />
								<p:calendar id="dataCadastro" value="#{canticoBean.dataCadastroCantico}" effect="show" pattern="dd/MM/yyyy" locale="pt" navigator="true" mask="true" style="margin-top:-1px;" disabled="true" required="true" />
								<p:message for="dataCadastro" />

								<p:outputLabel value="#{strg['label.dataRecebimento']}" for="dataRecebimento" />
								<p:calendar id="dataRecebimento" value="#{canticoBean.cantico.dataRecebimento}" maxdate="#{now}" effect="show" pattern="dd/MM/yyyy" locale="pt_BR" navigator="true" mask="true" style="margin-top:-1px;" required="false" />
								<p:message for="dataRecebimento" />
							</h:panelGrid>
						</p:panel>
					</p:tab>
					<p:tab id="tabOcasioes" title="#{strg['label.aba.ocasioes']}">
						<p:panel>
							<h:panelGrid columns="3">
								<p:pickList id="ocasioes" converter="OcasiaoConverter" value="#{canticoBean.dualOcasioes}" var="ocasiao" itemLabel="#{ocasiao.descricao}" itemValue="#{ocasiao}" effect="pulsate" addLabel="#{strg['label.picklist.passarSelecionados']}" addAllLabel="#{strg['label.picklist.passarTodos']}" removeAllLabel="#{strg['label.picklist.removerTodos']}" removeLabel="#{strg['label.picklist.removerSelecionados']}" labelDisplay="inline" style="margin-left:auto; margin-right:auto; width:100%">
									<f:facet name="sourceCaption">
										<h:outputText value="#{strg['label.ocasioesCadastradas']}" />
									</f:facet>
									<f:facet name="targetCaption">
										<h:outputText value="#{strg['label.ocasioesDoCantico']}" />
									</f:facet>
								</p:pickList>
								<p:message for="ocasioes" />
								<p:commandLink title="#{strg['label.incluirNovaOcasiao']}" value="#{strg['label.incluirNovaOcasiao']}" onclick="PF('dialogOcasiao').show();" styleClass="linkIncluirNovo" />
							</h:panelGrid>
						</p:panel>
					</p:tab>
					<p:tab id="observacoes" title="#{strg['label.observacoes']}">
						<p:panel>
							<p:editor id="observacao" value="#{canticoBean.cantico.observacao}" maxlength="1000" controls="bold italic underline font size style color highlight bullets numbering alignleft center alignright justify cut copy paste rule outdent indent undo redo source"></p:editor>
						</p:panel>
					</p:tab>
					<p:tab id="tabArquivos" title="#{strg['label.aba.arquivos']}">
						<p:panel>
							<p:fileUpload required="true" update="@form" fileUploadListener="#{canticoBean.upload}" auto="false" multiple="true" mode="advanced" label="#{strg['label.fileUpload.selecionarArquivos']}" uploadLabel="#{strg['label.enviar']}" cancelLabel="#{strg['label.cancelar']}" sizeLimit="#{canticoBean.maxTamanhoArquivo}" dragDropSupport="true" previewWidth="50" fileLimit="#{canticoBean.maxArquivos}" invalidFileMessage="#{strg['message.fileUpload.tipoDeArquivoInvalido']}" invalidSizeMessage="#{strg['message.fileUpload.tamanhoDeArquivoInvalido']}" fileLimitMessage="#{strg['message.fileUpload.numeroMaxDeArquivosExcedido']}" messageTemplate="#{strg['message.fileUpload.mensagemModelo']}">
							</p:fileUpload>
							<p:spacer height="15px"></p:spacer>
							<p:dataTable var="arquivoTemp" value="#{canticoBean.cantico.arquivos}" rendered="#{!canticoBean.cantico.arquivos.isEmpty()}">
								<p:column headerText="#{strg['label.nome']}">
									<h:graphicImage value="../imagens/formatos/#{canticoBean.arquivoNegocio.getPorMimeType(arquivoTemp.mimeType)}.png" height="40" width="40" style="display:inline;float:left;" />
									<div style="display: inline; line-height: 40px; margin: 5px;">
										<h:outputText value="#{arquivoTemp.nome}" />
									</div>
								</p:column>
								<p:column headerText="#{strg['label.tamanho']}" width="12%" styleClass="alignRight">
									<h:outputText value="#{canticoBean.tamanhoFormatado(arquivoTemp.tamanho)}" />
								</p:column>
								<p:column headerText="#{strg['label.acoes']}" width="8%">
									<div class="colunaData">
										<h:commandLink action="#{canticoBean.removerArquivo(arquivoTemp)}">
											<f:ajax render="@form" execute="@this"></f:ajax>
											<h:graphicImage value="../imagens/remove.png" height="15" width="15" title="#{strg['label.remover']}" />
										</h:commandLink>
									</div>
								</p:column>
							</p:dataTable>
						</p:panel>
					</p:tab>
					<p:tab id="tabConfirmacao" title="#{strg['label.aba.confirmacao']}">
						<p:panel>
							<h:panelGrid columns="2" cellpadding="8px">
								<p:outputLabel value="#{strg['label.consolador']}" />
								<p:inputText value="#{canticoBean.cantico.consolador.irmao.nome}" title="#{canticoBean.cantico.consolador.irmao.nome}" readonly="true" styleClass="exibeCantico" />
								<p:outputLabel value="#{strg['label.recebedor']}" />
								<p:inputText value="#{canticoBean.cantico.recebedor.irmao.nome}" title="#{canticoBean.cantico.recebedor.irmao.nome}" readonly="true" styleClass="exibeCantico" />
								<p:outputLabel value="#{strg['label.dataCadastro']}" />
								<p:inputText value="#{formatsBean.getData(canticoBean.dataCadastroCantico)}" title="#{formatsBean.getData(canticoBean.dataCadastroCantico)}" readonly="true" styleClass="exibeCantico" />
								<p:outputLabel value="#{strg['label.dataRecebimento']}" />
								<p:inputText value="#{formatsBean.getData(canticoBean.cantico.dataRecebimento)}" title="#{formatsBean.getData(canticoBean.cantico.dataRecebimento)}" readonly="true" styleClass="exibeCantico" />
								<p:outputLabel value="#{strg['label.ocasioes']}" />
								<p:outputPanel>
									<div class="ui-autocomplete-multiple" style="margin: 0 !important;">
										<ul class="ui-autocomplete-multiple-container ui-widget ui-inputfield ui-state-default ui-corner-all">
											<ui:repeat var="ocasiao" value="#{canticoBean.cantico.ocasioes}">
												<li class="ui-autocomplete-token ui-state-active ui-corner-all ui-helper-hidden" style="display: list-item;"><span class="ui-autocomplete-token-label">#{ocasiao.descricao}</span></li>
											</ui:repeat>
										</ul>
									</div>
								</p:outputPanel>
								<p:outputLabel value="#{strg['label.observacao']}" />
								<p:editor value="#{canticoBean.cantico.observacao}" controls="" disabled="true" />
								<p:outputLabel value="#{strg['label.arquivos']}" />
								<p:dataTable var="arquivoTemp" value="#{canticoBean.cantico.arquivos}" rendered="#{!canticoBean.cantico.arquivos.isEmpty()}">
									<p:column headerText="#{strg['label.nome']}">
										<h:graphicImage value="../imagens/formatos/#{canticoBean.arquivoNegocio.getPorMimeType(arquivoTemp.mimeType)}.png" height="40" width="40" style="display:inline;float:left;" />
										<div style="display: inline; line-height: 40px; margin: 5px;">
											<h:outputText value="#{arquivoTemp.nome}" />
										</div>
									</p:column>
									<p:column headerText="#{strg['label.tamanho']}" width="12%" styleClass="alignRight">
										<h:outputText value="#{canticoBean.tamanhoFormatado(arquivoTemp.tamanho)}" />
									</p:column>
								</p:dataTable>
							</h:panelGrid>
						</p:panel>
						<p:spacer />
						<div class="painelBotoesCentralizado">
							<p:commandButton value="#{canticoBean.edicao ? strg['label.salvar'] : strg['label.incluirCantico']}" action="#{canticoBean.salvar()}" styleClass="botao botaoSalvar" ajax="false" disabled="#{!canticoBean.canticoValido}">
								<f:ajax execute="editor" render="pagina" />
							</p:commandButton>
							<div style="clear: both;" />
						</div>
					</p:tab>
				</p:wizard>
			</p:panel>
			<div class="painelBotoesCentralizado">
				<p:commandButton value="#{strg['label.remover']}" action="#{canticoBean.remover(canticoBean.cantico)}" rendered="#{canticoBean.edicao}" styleClass="botao botaoRemover" ajax="false" />
				<p:commandButton value="#{strg['label.incluirNovoCantico']}" action="#{canticoBean.novo()}" rendered="#{canticoBean.edicao}" styleClass="botao botaoNovo" ajax="false">
					<f:ajax render="editor" />
				</p:commandButton>
				<div style="clear: both;" />
			</div>
		</h:form>

		<p:spacer height="15" />
		<!-- ======================================================== FILTRO ======================================================== -->
		<h:form id="painelFiltro" prependId="false" acceptcharset="UTF-8">
			<f:ajax render="painelFiltro">
				<h:commandLink action="#{canticoBean.inverteFiltro()}" style="float:right;" rendered="#{canticoBean.exibindoFiltro}" value="#{strg['label.esconderFiltros']}" />
				<h:commandLink action="#{canticoBean.inverteFiltro()}" style="float:right;" rendered="#{!canticoBean.exibindoFiltro}" value="#{strg['label.exibirFiltros']}" />
			</f:ajax>
			<p:spacer height="1" />
			<p:panel rendered="#{canticoBean.exibindoFiltro}">
				<h:panelGrid columns="3">
					<p:outputLabel value="#{strg['label.campo']}" />
					<p:outputLabel value="#{strg['label.condicao']}" />
					<p:outputLabel value="#{strg['label.valor']}" />

					<p:selectOneMenu id="campo" value="#{canticoBean.condicaoAAdicionar.campo}" validatorMessage="#{strg['message.condicao.valorNulo']}">
						<f:validator disabled="true" />
						<f:ajax render="painelFiltro" />
						<f:selectItem itemLabel="#{strg['label.selecione']}" noSelectionOption="true" />
						<f:selectItems value="#{canticoBean.filtro.campos}" var="campo" itemLabel="#{campo.descricao}" itemValue="#{campo}" />
					</p:selectOneMenu>

					<p:selectOneMenu id="operador" value="#{canticoBean.condicaoAAdicionar.operador}">
						<f:selectItem itemLabel="#{strg['label.selecione']}" noSelectionOption="true"></f:selectItem>
						<f:selectItems value="#{canticoBean.condicaoAAdicionar.operadoresValidos}" />
					</p:selectOneMenu>
					<h:panelGroup>
						<h:panelGrid columns="10">
							<p:inputText id="valorAlfanumerico" value="#{canticoBean.condicaoAAdicionar.valor}" rendered="#{canticoBean.condicaoAAdicionar.valorAlfanumerico}" style="margin-top:-20px;" />
							<p:inputText id="valorNumerico" value="#{canticoBean.condicaoAAdicionar.valor}" rendered="#{canticoBean.condicaoAAdicionar.valorNumerico}" style="margin-top:-20px;">
								<pe:keyFilter mask="num"></pe:keyFilter>
							</p:inputText>
							<p:calendar id="valorTemporal" value="#{canticoBean.condicaoAAdicionar.valor}" rendered="#{canticoBean.condicaoAAdicionar.valorTemporal}" effect="show" pattern="dd/MM/yyyy HH:mm:ss" locale="pt" navigator="true" mask="true" style="margin-top:-1px;" />
							<p:selectOneMenu id="valorEnumerado" rendered="#{canticoBean.condicaoAAdicionar.valorEnumerado}" value="#{canticoBean.condicaoAAdicionar.valor}">
								<f:selectItem itemLabel="#{strg['label.selecione']}" noSelectionOption="true" />
								<f:selectItems value="#{canticoBean.condicaoAAdicionar.valoresEnumerados}" var="valor" itemValue="#{valor}" />
							</p:selectOneMenu>
							<p:commandButton id="adicionarCondicao" action="#{canticoBean.adicionarCondicao()}" value="#{strg['label.adicionarFiltro']}" styleClass="botao" style="margin-top:-2px;" ajax="false">
								<f:ajax render="pagina" execute="@form" />
							</p:commandButton>
						</h:panelGrid>
					</h:panelGroup>
				</h:panelGrid>
				<p:dataTable id="tabelaFiltros" value="#{canticoBean.filtro.condicoes}" var="condicao" rendered="#{!canticoBean.filtro.condicoes.isEmpty()}">
					<p:column headerText="#{strg['label.campo']}" width="30%">
						<h:outputText value="#{condicao.campo.descricao}" />
					</p:column>
					<p:column headerText="#{strg['label.condicao']}" width="30%">
						<h:outputText value="#{condicao.operador.descricao}" />
					</p:column>
					<p:column headerText="#{strg['label.valor']}" width="30%">
						<div class="colunaData">
							<h:outputText value="#{condicao.valorFormatado}" />
						</div>
					</p:column>
					<p:column headerText="#{strg['label.acoes']}" width="10%">
						<div class="colunaData">
							<h:commandLink action="#{canticoBean.removerCondicao(condicao)}">
								<f:ajax render="pagina" execute="tabelaFiltros"></f:ajax>
								<h:graphicImage value="../imagens/remove.png" height="15" width="15" title="#{strg['label.remover']}" />
							</h:commandLink>
						</div>
					</p:column>
				</p:dataTable>
			</p:panel>
		</h:form>
		<p:spacer height="1" />
		<!-- ======================================================== TABELA ======================================================== -->
		<h:form acceptcharset="UTF-8">
			<p:dataTable id="tabelaValores" var="canticoTemp" value="#{canticoBean.dataModel}" paginator="true" rows="10" lazy="true" resizableColumns="true" sortMode="multiple" emptyMessage="#{strg['message.nenhumRegistroEncontrado']}" selection="#{canticoBean.cantico}" selectionMode="single" rowsPerPageLabel="#{strg['label.linhasPorPagina']}" rowsPerPageTemplate="5,10,20,30,40,50,100,200,300,400,500,1000" currentPageReportTemplate="#{strg['label.exibindoNaTabela']}" paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">
				<p:ajax event="rowSelect" update="@([id$=editor])" process="@([id$=tabelaValores])" />
				<p:column width="10%" sortBy="#{ocasiaoTemp.id}" headerText="#{strg['label.codigo']}">
					<div class="colunaCodigo">
						<h:outputText value="#{ocasiaoTemp.id}" title="#{ocasiaoTemp.id}" />
					</div>
				</p:column>
				<p:column sortBy="#{canticoBean.cantico.consolador}">
					<f:facet name="header"> #{strg['label.consolador']} </f:facet>
					<h:outputText value=" #{canticoBean.cantico.consolador}" title="#{canticoBean.cantico.consolador}" />
				</p:column>
				<p:column sortBy="#{canticoBean.cantico.recebedor}">
					<f:facet name="header"> #{strg['label.recebedor']} </f:facet>
					<h:outputText value=" #{canticoBean.cantico.recebedor}" title="#{canticoBean.cantico.recebedor}" />
				</p:column>
			</p:dataTable>
		</h:form>


		<!-- ======================================================== DIALOGS ======================================================= -->

		<p:dialog widgetVar="dialogConsolador" dynamic="true" fitViewport="true" hideEffect="puff" showEffect="puff" minimizable="false" maximizable="true" closeOnEscape="true">
			Consolador
		</p:dialog>
		<p:dialog widgetVar="dialogRecebedor" dynamic="true" fitViewport="true" hideEffect="puff" showEffect="puff" minimizable="false" maximizable="true" closeOnEscape="true">
			Recebedor
		</p:dialog>
		<p:dialog widgetVar="dialogOcasiao" dynamic="true" fitViewport="true" hideEffect="puff" showEffect="puff" minimizable="false" maximizable="true" closeOnEscape="true">
			Ocasiao	
		</p:dialog>



		<br />
		<br />
	</ui:define>
</ui:composition>
