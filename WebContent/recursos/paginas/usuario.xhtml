<ui:composition template="/WEB-INF/paginas/template.xhtml" xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:f="http://java.sun.com/jsf/core" xmlns:h="http://java.sun.com/jsf/html" xmlns:p="http://primefaces.org/ui" xmlns:c="http://java.sun.com/jsp/jstl/core">

	<ui:define name="title">#{strg['label.usuarios']}</ui:define>
	<ui:define name="body">
		<!-- ======================================================== EDITOR ======================================================== -->
		<h:panelGrid id="pagina">
			<h:panelGroup>
				<p:panel id="usuarioEditor">
					<h:panelGrid columns="2">
						<h:form id="usuarioForm" prependId="false" enctype="multipart/form-data" acceptcharset="UTF-8">
							<p:growl id="growl" showDetail="true" sticky="true" globalOnly="true" />
							<h:panelGrid columns="3" layout="grid">
								<p:outputLabel value="#{strg['label.codigo']}" for="codigo" rendered="#{usuarioBean.edicao}" />
								<p:inputText id="codigo" value="#{usuarioBean.usuario.id}" required="true" size="50" disabled="true" rendered="#{usuarioBean.edicao}" />
								<p:message for="codigo" rendered="#{usuarioBean.edicao}" />

								<p:outputLabel value="#{strg['label.nome']}" for="nome" />
								<p:inputText id="nome" value="#{usuarioBean.usuario.irmao.nome}" required="true" size="50" />
								<p:message for="nome" />

								<p:outputLabel value="#{strg['label.email']}" for="email" />
								<p:inputText id="email" value="#{usuarioBean.usuario.email}" required="true" size="50" />
								<p:message for="email" />

								<p:outputLabel value="#{strg['label.senha']}" for="senha" rendered="#{!usuarioBean.edicao}" />
								<p:password id="senha" redisplay="true" value="#{usuarioBean.usuario.senha}" inline="true" feedback="true" required="true" goodLabel="#{strg['label.bom']}" weakLabel="#{strg['label.fraco']}" strongLabel="#{strg['label.excelente']}" promptLabel="#{strg['label.senha']}" size="50" rendered="#{!usuarioBean.edicao}" />
								<p:message for="senha" rendered="#{!usuarioBean.edicao}" />
								<p:outputLabel value="#{strg['label.confimeASenha']}" for="confirmeSenha" rendered="#{!usuarioBean.edicao}" />
								<p:password id="confirmeSenha" redisplay="true" value="#{usuarioBean.usuario.confirmeSenha}" required="true" size="50" rendered="#{!usuarioBean.edicao}" />
								<p:message for="confirmeSenha" rendered="#{!usuarioBean.edicao}" />

								<p:outputLabel value="#{strg['label.foto']}" for="imagem" />
								<h:inputFile id="imagem" styleClass="inputFile" value="#{usuarioBean.imageFile}" autocomplete="off">
									<f:validator validatorId="imageValidator" />
								</h:inputFile>
								<p:message for="imagem" />

								<p:outputLabel value="#{strg['label.observacao']}" for="observacao" />
								<p:inputTextarea id="observacao" value="#{usuarioBean.usuario.irmao.observacao}" cols="53" rows="2" />
								<p:message for="observacao" />
							</h:panelGrid>
							<h:commandButton value="#{strg['label.salvar']}" action="#{usuarioBean.salvar()}" style="margin-top: 10px;" styleClass="botao">
								<f:ajax execute="usuarioEditor" render="pagina" />
							</h:commandButton>
							<h:commandButton value="#{strg['label.novo']}" action="#{usuarioBean.novo()}" style="margin-top: 10px;" rendered="#{usuarioBean.edicao}" styleClass="botao">
								<f:ajax render="usuarioEditor" />
							</h:commandButton>
						</h:form>
						<h:panelGroup rendered="#{usuarioBean.edicao}">
							<div align="center" style="border: 1px solid gray; margin: -25px 30px 30px 30px; padding: 5px;">
								<h:graphicImage value="../../imagemstream/usuario/#{usuarioBean.usuario.id}:#{formatsBean.currentTimeMillis}" height="120" width="120" />
							</div>
						</h:panelGroup>
					</h:panelGrid>
				</p:panel>

				<p:spacer height="15" />
				<!-- ======================================================== FILTRO ======================================================== -->
				<h:form id="painelFiltro" prependId="false" acceptcharset="UTF-8">
					<f:ajax render="painelFiltro">
						<h:commandLink action="#{usuarioBean.inverteFiltro()}" style="float:right;" rendered="#{usuarioBean.exibindoFiltro}" value="#{strg['label.esconderFiltros']}" />
						<h:commandLink action="#{usuarioBean.inverteFiltro()}" style="float:right;" rendered="#{!usuarioBean.exibindoFiltro}" value="#{strg['label.exibirFiltros']}" />
					</f:ajax>
					<p:spacer height="1" />
					<p:panel rendered="#{usuarioBean.exibindoFiltro}">
						<h:panelGrid columns="3">
							<p:outputLabel value="#{strg['label.campo']}" />
							<p:outputLabel value="#{strg['label.condicao']}" />
							<p:outputLabel value="#{strg['label.valor']}" />

							<p:selectOneMenu id="campo" value="#{usuarioBean.condicaoAAdicionar.campo}" validatorMessage="#{strg['message.condicao.valorNulo']}">
								<f:validator disabled="true" />
								<f:ajax render="operador"></f:ajax>
								<f:selectItem itemLabel="#{strg['label.selecione']}" noSelectionOption="true"></f:selectItem>
								<f:selectItems value="#{usuarioBean.filtro.campos}" var="campo" itemLabel="#{campo.descricao}" itemValue="#{campo}" />
								<f:converter converterId="campoConverter" />
							</p:selectOneMenu>

							<p:selectOneMenu id="operador" value="#{usuarioBean.condicaoAAdicionar.operador}">
								<f:selectItem itemLabel="#{strg['label.selecione']}" noSelectionOption="true"></f:selectItem>
								<f:selectItems value="#{usuarioBean.condicaoAAdicionar.operadoresValidos}" />
							</p:selectOneMenu>
							<h:panelGroup>
								<p:inputText id="valor" value="#{usuarioBean.condicaoAAdicionar.valor}" />
								<h:commandButton action="#{usuarioBean.adicionarCondicao()}" value="#{strg['label.adicionarFiltro']}" styleClass="botao">
									<f:ajax render="pagina" execute="campo operador valor"></f:ajax>
								</h:commandButton>
							</h:panelGroup>
						</h:panelGrid>
						<p:messages id="condicaoMsg" globalOnly="false"></p:messages>
						<p:dataTable id="tabelaFiltros" value="#{usuarioBean.filtro.condicoes}" var="condicao" rendered="#{!usuarioBean.filtro.condicoes.isEmpty()}">
							<p:column headerText="#{strg['label.campo']}" width="30%">
								<h:outputText value="#{condicao.campo.descricao}" />
							</p:column>
							<p:column headerText="#{strg['label.condicao']}" width="30%">
								<h:outputText value="#{condicao.operador.descricao}" />
							</p:column>
							<p:column headerText="#{strg['label.valor']}" width="30%">
								<h:outputText value="#{condicao.valor}" />
							</p:column>
							<p:column headerText="#{strg['label.acoes']}" width="10%">
								<div class="colunaData">
									<h:commandLink action="#{usuarioBean.removerCondicao(condicao)}">
										<f:ajax render="pagina" execute="tabelaFiltros"></f:ajax>
										<h:graphicImage value="../imagens/remove.png" height="15" width="15" title="#{strg['label.remover']}" />
									</h:commandLink>
								</div>
							</p:column>
						</p:dataTable>
					</p:panel>
				</h:form>
				<p:spacer height="1" />
				<!-- ======================================================== TABELA ======================================================== -->
				<h:form acceptcharset="UTF-8">
					<p:dataTable id="tabelaUsuarios" var="usuarioTemp" value="#{usuarioBean.usuarioDataModel}" paginator="true" rows="10" lazy="true" resizableColumns="true" sortMode="multiple" emptyMessage="#{strg['message.nenhumRegistroEncontrado']}" selection="#{usuarioBean.usuario}" selectionMode="single" rowsPerPageLabel="#{strg['label.linhasPorPagina']}" rowsPerPageTemplate="5,10,20,30,40,50,100,200,300,400,500,1000" currentPageReportTemplate="#{strg['label.exibindoNaTabela']}" paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">
						<p:ajax event="rowSelect" update="@([id$=usuarioEditor])" process="@([id$=tabelaUsuarios])" />
						<p:column width="7%" sortBy="#{usuarioTemp.id}" headerText="#{strg['label.codigo']}">
							<div class="colunaCodigo">
								<h:outputText value="#{usuarioTemp.id}" title="#{usuarioTemp.id}" />
							</div>
						</p:column>
						<p:column width="28%" sortBy="#{usuarioTemp.irmao.nome}">
							<f:facet name="header"> #{strg['label.nome']} </f:facet>
							<h:graphicImage value="../../imagemstream/usuario/#{usuarioTemp.id}:#{formatsBean.currentTimeMillis}" height="20" width="20" styleClass="iconeUsuarioTabela" />
							<h:outputText value="#{usuarioTemp.irmao.nome}" title="#{usuarioTemp.irmao.nome}" />
						</p:column>
						<p:column width="15%" sortBy="#{usuarioTemp.email}">
							<f:facet name="header"> #{strg['label.email']} </f:facet>
							<a href="mailto:#{usuarioTemp.email}" title="#{usuarioTemp.email}">#{usuarioTemp.email}</a>
						</p:column>
						<p:column width="15%" sortBy="#{usuarioTemp.dataCadastro}">
							<f:facet name="header">#{strg['label.dataCadastro']}</f:facet>
							<div class="colunaData">
								<h:outputFormat value="#{formatsBean.getTimestamp(usuarioTemp.dataCadastro)}" title="#{formatsBean.getTimestamp(usuarioTemp.dataCadastro)}" />
							</div>
						</p:column>
						<p:column sortBy="#{usuarioTemp.irmao.observacao}">
							<f:facet name="header">#{strg['label.observacao']}</f:facet>
							<h:outputText value="#{usuarioTemp.irmao.observacao}" title="#{usuarioTemp.irmao.observacao}" />
						</p:column>
						<p:column width="8%" sortBy="1">
							<f:facet name="header">#{strg['label.acoes']}</f:facet>
							<div class="colunaData">
								<h:commandLink action="#{usuarioBean.remover(usuarioTemp)}">
									<f:ajax render="tabelaUsuarios usuarioEditor" execute="@this"></f:ajax>
									<h:graphicImage value="../imagens/remove.png" height="15" width="15" title="#{strg['label.remover']}" />
								</h:commandLink>
							</div>
						</p:column>
					</p:dataTable>
				</h:form>
			</h:panelGroup>
		</h:panelGrid>
	</ui:define>
</ui:composition>
